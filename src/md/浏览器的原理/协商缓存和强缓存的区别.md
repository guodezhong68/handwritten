

强缓存

使用强缓存策略时，如果缓存资源有效，则直接使用缓存资源，不必再向服务器发起请求

强缓存策略可以用两种方式来设置
http头信息中的 Expires 和 Cache-Control

Expires
/ɪkˈspaɪəz/
指定资源的过期时间，在过期时间内，该资源可以被缓存使用，
这个时间是一个绝对时间，它是服务器时间，
如果客户端时间和服务端时间不一致，或者用户可以修改客户端的时间，
就会影响缓存的命中

因为它的一些缺点，在http1.1中提出
Cache-Control
/kæʃ/ /kənˈtrəʊl/

public
表示可以被任何对象缓存，包括发送请求的客户端和代理服务器
不常用，一般使用max-age=
private
表示只能被浏览器缓存，不允许任何代理服务器缓存，
实际开发中对于一些含有用户信息的HTML通常都要设置这个字段值
no-cache
设置了该字段需要先和服务器确认资源是否发生了变化，未发生变化则直接使用缓存
no-store
设置了该字段表示禁止任何缓存
max-age=
设置缓存的最大有效期/秒
s-maxage=
优先级高于max-age=，仅适用于代理服务器共享缓存
max-stale[=]
表示客户端愿意接收已经过期的资源，但不能超过给定的时间限制



协商缓存
如果命中强缓存，则无需发起新的请求，直接使用缓存内容
如果没有命中，且设置了协商缓存，则走协商缓存

命中协商缓存的两个条件：
max-age=
no-store

使用协商缓存时，会先向服务器发送一个请求，
如果资源没有发生修改则返回一个304，让浏览器使用本地的缓存副本，
如果资源发生修改，则返回修改后的资源

协商缓存也可以用两种方式设置

Last-Modified
服务器在响应头中添加Last-Modified属性指出最后一次修改时间
客户端请求头添加If-Modified-Since属性,属性为上一次资源返回时的Last-Modified
当客户端发起请求时，与服务器比较，判断资源是否做了修改
缺点：
这种方法有一个缺点，只能精确到秒级，如果一秒内发生了多次修改的话，
会造成命中不准确

Etag
这个属性是资源生成的唯一标识符，资源发生修改就会发生改变
客户端在请求头添加If-None-Match，这个属性就是上一次返回资源的Etag
服务器接收到这个请求时，会与资源当前的Etag比较，判断是否发生修改

同时出现的时候Etag优先级更高，
服务端负载平衡时，因为多个服务器的资源Etag不一致，最好不要设置Etag


总结
强缓存和协商缓存
在缓存命中时都会直接使用本地的缓存副本， 区别在于协商缓存会向服务器发送一次请求
在缓存不命中时都会先服务器发送请求来获取资源，
在实际缓存机制中，它们是一起合作使用的。

浏览器首先会根据请求的信息判断强缓存是否命中，如果命中则直接使用资源，
如果不命中则根据头信息向服务器发起请求，使用协商缓存，
如果协商缓存命中的话，则服务器不用返回资源，浏览器直接使用本地资源副本，
如果协商缓存不命中则浏览器返回最新的资源给服务器


